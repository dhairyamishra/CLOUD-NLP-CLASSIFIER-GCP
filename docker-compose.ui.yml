# ============================================================================
# Docker Compose Configuration for Streamlit UI Development
# ============================================================================
# This file provides a development setup for the Streamlit UI with hot reload
#
# Usage:
#   docker-compose -f docker-compose.ui.yml up        # Start UI only
#   docker-compose -f docker-compose.ui.yml up -d     # Start in background
#   docker-compose -f docker-compose.ui.yml down      # Stop UI
#   docker-compose -f docker-compose.ui.yml logs -f   # Follow logs
#
# To run both API and UI:
#   docker-compose -f docker-compose.yml -f docker-compose.ui.yml up
# ============================================================================

version: '3.8'

services:
  # Streamlit Interactive UI (Development Mode)
  ui-dev:
    build:
      context: .
      dockerfile: Dockerfile.streamlit
    image: cloud-nlp-classifier-ui:dev
    container_name: nlp-ui-dev
    ports:
      - "8501:8501"
    environment:
      # Streamlit settings
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - STREAMLIT_SERVER_HEADLESS=true
      - STREAMLIT_BROWSER_GATHER_USAGE_STATS=false
      - STREAMLIT_SERVER_RUN_ON_SAVE=true
      - STREAMLIT_SERVER_FILE_WATCHER_TYPE=auto
    volumes:
      # Mount source code for hot reload
      - ./src/ui:/app/src/ui
      - ./src/ui/components:/app/src/ui/components
      - ./src/ui/utils:/app/src/ui/utils
      - ./.streamlit:/app/.streamlit
      # Mount models directory
      - ./models:/app/models
      # Mount config
      - ./config:/app/config
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - nlp-network
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2.5G
        reservations:
          cpus: '0.5'
          memory: 1G

networks:
  nlp-network:
    driver: bridge
    name: nlp-network
